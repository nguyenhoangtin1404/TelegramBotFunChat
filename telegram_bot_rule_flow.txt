RULE & FLOW SPEC FOR TELEGRAM FUN CHAT BOT (PYTHON)

1. SYSTEM GOAL
- Build a Telegram bot using Python.
- Bot listens to group messages.
- Bot auto-mentions the sender and replies with a fun message.
- Primary reply is generated by Groq AI.
- If Groq fails, bot generates a random fallback fun message.

2. INPUT
- Telegram group text messages.
- Telegram metadata: chat_id, user_id, username, message_id, message_text.

3. OUTPUT
- Reply message in Telegram group:
  [Name](tg://user?id=USER_ID) + AI response OR fallback random message.
  Use reply_to_message_id to attach to original message.

4. PROGRAM FLOW
1. Receive update from Telegram (webhook or polling).
2. Ignore:
   - Bot messages
   - Non-text messages
3. Extract chat_id, message_id, user_id, username, text.
4. Call Groq API:
   - Endpoint: https://api.groq.com/openai/v1/chat/completions
   - Model: llama3-8b-instant or llama3-70b-versatile
   - Prompt includes system role and user message.
5. If Groq response OK â†’ use AI message.
6. If Groq fails â†’ use fallback random fun message.
7. Build reply:
   [DisplayName](tg://user?id=USER_ID) + " " + reply_text
8. Send via Telegram sendMessage with reply_to_message_id.
9. Log errors gracefully.
10. Continue listening.

5. FUNCTIONAL REQUIREMENTS
- Auto-mention user.
- AI generation via Groq.
- Fallback random list if AI fails.
- Reply directly to original message.
- Handle Unicode/Vietnamese.

6. NON-FUNCTIONAL REQUIREMENTS
- Response <2s for AI, <0.2s for fallback.
- Stable 24/7.
- No crash on malformed data.

7. PYTHON MODULES
- requests
- random
- python-telegram-bot (optional)

8. GROQ API FORMAT
POST https://api.groq.com/openai/v1/chat/completions
Headers:
  Authorization: Bearer <GROQ_API_KEY>
Body:
  {
    "model": "llama3-8b-instant",
    "messages": [
      {"role": "system", "content": "Báº¡n lÃ  bot chat vui váº» trong group."},
      {"role": "user", "content": "<user_message>"}
    ]
  }

9. TELEGRAM SEND MESSAGE API
POST https://api.telegram.org/bot<TOKEN>/sendMessage
Body:
  {
    "chat_id": chat_id,
    "text": reply_message,
    "reply_to_message_id": message_id,
    "parse_mode": "Markdown"
  }

10. FALLBACK MESSAGES
- "Haha nghe vui Ã  nha ðŸ˜†"
- "á»¦a gÃ¬ zá»£? ðŸ˜‚ ká»ƒ nghe coi"
- "Bot xá»‰u ngang ðŸ¤£"
- "GhÃª zá»£ Ã´ng báº¡n ðŸ˜œ"
- "CÃ¡i nÃ y coi bá»™ cÄƒng Ã  nha ðŸ˜†"

END OF SPEC
